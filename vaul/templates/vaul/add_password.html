{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="card" style="max-width:560px;margin:24px auto;">
  <h2>Agregar contraseña</h2>
  <form method="post" action="{% url 'add_password' %}" class="grid">
    {% csrf_token %}
    <div class="field">
      <label>Nombre del sitio</label>
      <input type="text" name="site_name" placeholder="Nombre del sitio" value="{{ site_name|default:'' }}" required>
    </div>
    <div class="field">
      <label>URL del sitio</label>
      <input type="url" name="site_url" placeholder="https://..." value="{{ site_url|default:'' }}" required>
    </div>
    <div class="field">
      <label>Usuario</label>
      <input type="text" name="username" placeholder="Usuario" value="{{ username|default:'' }}" required>
    </div>
    <div class="field">
      <label>Categoría</label>
      <select name="category" style="width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid #374151; background: #0b1220; color: var(--text);">
        <option value="other">Otro</option>
        <option value="work">Trabajo</option>
        <option value="personal">Personal</option>
        <option value="social">Redes Sociales</option>
        <option value="finance">Finanzas</option>
        <option value="shopping">Compras</option>
        <option value="entertainment">Entretenimiento</option>
        <option value="education">Educación</option>
      </select>
    </div>
    <div class="field">
      <label>Contraseña</label>
      <div style="display:flex; gap:8px;">
        <input id="add-password" type="password" name="password" placeholder="Contraseña" style="flex:1;" required>
        <button id="toggle-add-pass" type="button" class="btn">Mostrar</button>
        <button id="generate-password" type="button" class="btn" title="Generar contraseña segura">
          <i class="fas fa-key"></i>
        </button>
      </div>
      <div style="margin-top:8px; display:grid; gap:6px;">
        <meter id="add-meter" min="0" max="5" low="2" high="4" optimum="5" value="0"></meter>
        <small id="add-label" class="muted">Fortaleza: Muy débil</small>
      </div>
    </div>
    <div class="field">
      <label>Notas (opcional)</label>
      <textarea name="notes" placeholder="Información adicional sobre esta contraseña..." rows="3" style="width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid #374151; background: #0b1220; color: var(--text); resize: vertical;">{{ notes|default:'' }}</textarea>
    </div>
    <div>
      <button type="submit" class="btn primary">Guardar</button>
      <a class="btn" href="{% url 'dashboard' %}">Cancelar</a>
    </div>
  </form>
</div>

<script type="module">
import { attachPasswordStrengthMeter, attachPasswordToggle, preventDoubleSubmit, attachPasswordGenerator } from '/static/js/app.js';
attachPasswordStrengthMeter('#add-password', '#add-meter', '#add-label');
attachPasswordToggle('#toggle-add-pass', '#add-password');
attachPasswordGenerator('#generate-password', '#add-password', { length: 16 });
preventDoubleSubmit('form');
</script>
{% endblock %}
