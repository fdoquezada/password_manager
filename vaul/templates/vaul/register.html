{% extends 'base.html' %}
{% load static %}
{% block favicon %}
    <link rel="icon" href="{% static 'img/register.png' %}" type="image/x-icon">
{% endblock %}
{% block content %}
<div class="card" style="max-width:420px;margin:24px auto;">
  <h2>Crear cuenta</h2>
  <form method="post" action="{% url 'register' %}" class="grid">
    {% csrf_token %}
    <div class="field">
      <label>Usuario</label>
      <input type="text" name="username" placeholder="Usuario" value="{{ username_value|default:'' }}">
    </div>
    <div class="field">
      <label>Contraseña</label>
      <div style="display:flex; gap:8px;">
        <input id="reg-password" type="password" name="password" placeholder="Contraseña" style="flex:1;">
        <button id="toggle-pass" type="button" class="btn">Mostrar</button>
      </div>
      <div style="margin-top:8px; display:grid; gap:6px;">
        <meter id="strength-meter" min="0" max="5" low="2" high="4" optimum="5" value="0"></meter>
        <small id="strength-label" class="muted">Fortaleza: Muy débil</small>
      </div>
    </div>
    <div class="field">
      <label>Confirmar contraseña</label>
      <input id="reg-confirm" type="password" name="confirm_password" placeholder="Repite tu contraseña">
      <small id="confirm-msg" class="muted"></small>
    </div>
    <div>
      <button type="submit" class="btn primary">Crear cuenta</button>
    </div>
    <p class="muted">¿Ya tienes cuenta? <a href="{% url 'login' %}">Inicia sesión</a></p>
  </form>

<script type="module">
import { attachPasswordStrengthMeter, attachPasswordToggle, preventDoubleSubmit } from '/static/js/app.js';
attachPasswordStrengthMeter('#reg-password', '#strength-meter', '#strength-label');
attachPasswordToggle('#toggle-pass', '#reg-password');
preventDoubleSubmit('form');
const pass = document.querySelector('#reg-password');
const confirm = document.querySelector('#reg-confirm');
const msg = document.querySelector('#confirm-msg');
function updateMatch(){
  if (!pass || !confirm || !msg) return;
  if (!confirm.value) { msg.textContent = ''; return; }
  msg.textContent = pass.value === confirm.value ? 'Coinciden' : 'No coinciden';
  msg.style.color = pass.value === confirm.value ? '#a7f3d0' : '#fecaca';
}
pass && pass.addEventListener('input', updateMatch);
confirm && confirm.addEventListener('input', updateMatch);
</script>
</div>
{% endblock %}

